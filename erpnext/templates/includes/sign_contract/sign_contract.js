$(document).ready(function () {
    var $signContract = $("#submitBtn");
    var $renewBtn = $("#renewButton");
    var $sigdiv = $("#signature")
    $sigdiv.jSignature();
    $sigdiv.jSignature("reset")

    $signContract.on("click", function () {

    });

    $renewBtn.on("click", function () {
        frappe.call({
            method: "erpnext.crm.doctype.contract.contract.reset_token",
            args: {
                contract_name: "{{ contract.name }}",
                email: "{{ contract.email }}"
            },
            freeze: true,
            callback: function (r) {
                if (!r.exc) {
                    location.reload(forcedReload = true);
                }
                else {
                    frappe.msgprint(r.exc)
                }
            }
        })
    });

    $(".nav-item, .nav-item .nav-link").on('click', function (e) {
        e.preventDefault();
        e.stopPropagation();
    })

    $("#step1").on("click", function () {
        $("#review").addClass("active show in");
        $("#about").removeClass("active show in");
        $(".nav-item a.review-sign, #review").addClass("active show");
        $(".nav-item a.about, #about").removeClass("active show");
        $(".modal-backdrop.fade.show").hide();
        $(window).trigger("resize"); // Ugly hack to make JSignature work
    });

    $("#step2").on("click", function () {

        
        var sign = $sigdiv.jSignature("getData");
        var signee = document.getElementById("signee").value;

        var blankSign = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA/wAAAD/CAYAAABM3d3IAAAUZklEQVR4Xu3XwXEbUQwFQW2QjsEpMATG4BCUJB3Dq+IFU63zF2vRwGWeH38ECBAgQIAAAQIECBAgQIBATuDJTWQgAgQIECBAgAABAgQIECBA4EfwOwICBAgQIECAAAECBAgQIBAUEPzBpRqJAAECBAgQIECAAAECBAgIfjdAgAABAgQIECBAgAABAgSCAoI/uFQjESBAgAABAgQIECBAgAABwe8GCBAgQIAAAQIECBAgQIBAUEDwB5dqJAIECBAgQIAAAQIECBAgIPjdAAECBAgQIECAAAECBAgQCAoI/uBSjUSAAAECBAgQIECAAAECBAS/GyBAgAABAgQIECBAgAABAkEBwR9cqpEIECBAgAABAgQIECBAgIDgdwMECBAgQIAAAQIECBAgQCAoIPiDSzUSAQIECBAgQIAAAQIECBAQ/G6AAAECBAgQIECAAAECBAgEBQR/cKlGIkCAAAECBAgQIECAAAECgt8NECBAgAABAgQIECBAgACBoIDgDy7VSAQIECBAgAABAgQIECBAQPC7AQIECBAgQIAAAQIECBAgEBQQ/MGlGokAAQIECBAgQIAAAQIECAh+N0CAAAECBAgQIECAAAECBIICgj+4VCMRIECAAAECBAgQIECAAAHB7wYIECBAgAABAgQIECBAgEBQQPAHl2okAgQIECBAgAABAgQIECAg+N0AAQIECBAgQIAAAQIECBAICgj+4FKNRIAAAQIECBAgQIAAAQIEBL8bIECAAAECBAgQIECAAAECQQHBH1yqkQgQIECAAAECBAgQIECAgOB3AwQIECBAgAABAgQIECBAICgg+INLNRIBAgQIECBAgAABAgQIEBD8boAAAQIECBAgQIAAAQIECAQFBH9wqUYiQIAAAQIECBAgQIAAAQKC3w0QIECAAAECBAgQIECAAIGggOAPLtVIBAgQIECAAAECBAgQIEBA8LsBAgQIECBAgAABAgQIECAQFBD8waUaiQABAgQIECBAgAABAgQICH43QIAAAQIECBAgQIAAAQIEggKCP7hUIxEgQIAAAQIECBAgQIAAAcHvBggQIECAAAECBAgQIECAQFBA8AeXaiQCBAgQIECAAAECBAgQICD43QABAgQIECBAgAABAgQIEAgKCP7gUo1EgAABAgQIECBAgAABAgQEvxsgQIAAAQIECBAgQIAAAQJBAcEfXKqRCBAgQIAAAQIECBAgQICA4HcDBAgQIECAAAECBAgQIEAgKCD4g0s1EgECBAgQIECAAAECBAgQEPxugAABAgQIECBAgAABAgQIBAUEf3CpRiJAgAABAgQIECBAgAABAoLfDRAgQIAAAQIECBAgQIAAgaCA4A8u1UgECBAgQIAAAQIECBAgQEDwuwECBAgQIECAAAECBAgQIBAUEPzBpRqJAAECBAgQIECAAAECBAgIfjdAgAABAgQIECBAgAABAgSCAoI/uFQjESBAgAABAgQIECBAgAABwe8GCBAgQIAAAQIECBAgQIBAUEDwB5dqJAIECBAgQIAAAQIECBAgIPjdAAECBAgQIECAAAECBAgQCAoI/uBSjUSAAAECBAgQIECAAAECBAS/GyBAgAABAgQIECBAgAABAkEBwR9cqpEIECBAgAABAgQIECBAgIDgdwMECBAgQIAAAQIECBAgQCAoIPiDSzUSAQIECBAgQIAAAQIECBAQ/G6AAAECBAgQIECAAAECBAgEBQR/cKlGIkCAAAECBAgQIECAAAECgt8NECBAgAABAgQIECBAgACBoIDgDy7VSAQIECBAgAABAgQIECBAQPC7AQIECBAgQIAAAQIECBAgEBQQ/MGlGokAAQIECBAgQIAAAQIECAh+N0CAAAECBAgQIECAAAECBIICgj+4VCMRIECAAAECBAgQIECAAAHB7wYIECBAgAABAgQIECBAgEBQQPAHl2okAgQIECBAgAABAgQIECAg+N0AAQIECBAgQIAAAQIECBAICgj+4FKNRIAAAQIECBAgQIAAAQIEBL8bIECAAAECBAgQIECAAAECQQHBH1yqkQgQIECAAAECBAgQIECAgOB3AwQIECBAgAABAgQIECBAICgg+INLNRIBAgQIECBAgAABAgQIEBD8boAAAQIECBAgQIAAAQIECAQFBH9wqUYiQIAAAQIECBAgQIAAAQKC3w0QIECAAAECBAgQIECAAIGggOAPLtVIBAgQIECAAAECBAgQIEBA8LsBAgQIECBAgAABAgQIECAQFBD8waUaiQABAgQIECBAgAABAgQICH43QIAAAQIECBAgQIAAAQIEggKCP7hUIxEgQIAAAQIECBAgQIAAAcHvBggQIECAAAECBAgQIECAQFBA8AeXaiQCBAgQIECAAAECBAgQICD43QABAgQIECBAgAABAgQIEAgKCP7gUo1EgAABAgQIECBAgAABAgQEvxsgQIAAAQIECBAgQIAAAQJBAcEfXKqRCBAgQIAAAQIECBAgQICA4HcDBAgQIECAAAECBAgQIEAgKCD4g0s1EgECBAgQIECAAAECBAgQEPxugAABAgQIECBAgAABAgQIBAUEf3CpRiJAgAABAgQIECBAgAABAoLfDRAgQIAAAQIECBAgQIAAgaCA4A8u1UgECBAgQIAAAQIECBAgQEDwuwECBAgQIECAAAECBAgQIBAUEPzBpRqJAAECBAgQIECAAAECBAgIfjdAgAABAgQIECBAgAABAgSCAoI/uFQjESBAgAABAgQIECBAgAABwe8GCBAgQIAAAQIECBAgQIBAUEDwB5dqJAIECBAgQIAAAQIECBAgIPjdAAECBAgQIECAAAECBAgQCAoI/uBSjUSAAAECBAgQIECAAAECBAS/GyBAgAABAgQIECBAgAABAkEBwR9cqpEIECBAgAABAgQIECBAgIDgdwMECBAgQIAAAQIECBAgQCAoIPiDSzUSAQIECBAgQIAAAQIECBAQ/G6AAAECBAgQIECAAAECBAgEBQR/cKlGIkCAAAECBAgQIECAAAECgt8NECBAgAABAgQIECBAgACBoIDgDy7VSAQIECBAgAABAgQIECBAQPC7AQIECBAgQIAAAQIECBAgEBQQ/MGlGokAAQIECBAgQIAAAQIECAh+N0CAAAECBAgQIECAAAECBIICgj+4VCMRIECAAAECBAgQIECAAAHB7wYIECBAgAABAgQIECBAgEBQQPAHl2okAgQIECBAgAABAgQIECAg+N0AAQIECBAgQIAAAQIECBAICgj+4FKNRIAAAQIECBAgQIAAAQIEBL8bIECAAAECBAgQIECAAAECQQHBH1yqkQgQIECAAAECBAgQIECAgOB3AwQIECBAgAABAgQIECBAICgg+INLNRIBAgQIECBAgAABAgQIEBD8boAAAQIECBAgQIAAAQIECAQFBH9wqUYiQIAAAQIECBAgQIAAAQKC3w0QIECAAAECBAgQIECAAIGggOAPLtVIBAgQIECAAAECBAgQIEBA8LsBAgQIECBAgAABAgQIECAQFBD8waUaiQABAgQIECBAgAABAgQICH43QIAAAQIECBAgQIAAAQIEggKCP7hUIxEgQIAAAQIECBAgQIAAAcHvBggQIECAAAECBAgQIECAQFBA8AeXaiQCBAgQIECAAAECBAgQICD43QABAgQIECBAgAABAgQIEAgKCP7gUo1EgAABAgQIECBAgAABAgQEvxsgQIAAAQIECBAgQIAAAQJBAcEfXKqRCBAgQIAAAQIECBAgQICA4HcDBAgQIECAAAECBAgQIEAgKCD4g0s1EgECBAgQIECAAAECBAgQEPxugAABAgQIECBAgAABAgQIBAUEf3CpRiJAgAABAgQIECBAgAABAoLfDRAgQIAAAQIECBAgQIAAgaCA4A8u1UgECBAgQIAAAQIECBAgQEDwuwECBAgQIECAAAECBAgQIBAUEPzBpRqJAAECBAgQIECAAAECBAgIfjdAgAABAgQIECBAgAABAgSCAoI/uFQjESBAgAABAgQIECBAgAABwe8GCBAgQIAAAQIECBAgQIBAUEDwB5dqJAIECBAgQIAAAQIECBAgIPjdAAECBAgQIECAAAECBAgQCAoI/uBSjUSAAAECBAgQIECAAAECBAS/GyBAgAABAgQIECBAgAABAkEBwR9cqpEIECBAgAABAgQIECBAgIDgdwMECBAgQIAAAQIECBAgQCAoIPiDSzUSAQIECBAgQIAAAQIECBAQ/G6AAAECBAgQIECAAAECBAgEBQR/cKlGIkCAAAECBAgQIECAAAECgt8NECBAgAABAgQIECBAgACBoIDgDy7VSAQIECBAgAABAgQIECBAQPC7AQIECBAgQIAAAQIECBAgEBQQ/MGlGokAAQIECBAgQIAAAQIECAh+N0CAAAECBAgQIECAAAECBIICgj+4VCMRIECAAAECBAgQIECAAAHB7wYIECBAgAABAgQIECBAgEBQQPAHl2okAgQIECBAgAABAgQIECAg+N0AAQIECBAgQIAAAQIECBAICgj+4FKNRIAAAQIECBAgQIAAAQIEBL8bIECAAAECBAgQIECAAAECQQHBH1yqkQgQIECAAAECBAgQIECAgOB3AwQIECBAgAABAgQIECBAICgg+INLNRIBAgQIECBAgAABAgQIEBD8boAAAQIECBAgQIAAAQIECAQFBH9wqUYiQIAAAQIECBAgQIAAAQKC3w0QIECAAAECBAgQIECAAIGggOAPLtVIBAgQIECAAAECBAgQIEBA8LsBAgQIECBAgAABAgQIECAQFBD8waUaiQABAgQIECBAgAABAgQICH43QIAAAQIECBAgQIAAAQIEggKCP7hUIxEgQIAAAQIECBAgQIAAAcHvBggQIECAAAECBAgQIECAQFBA8AeXaiQCBAgQIECAAAECBAgQICD43QABAgQIECBAgAABAgQIEAgKCP7gUo1EgAABAgQIECBAgAABAgQEvxsgQIAAAQIECBAgQIAAAQJBAcEfXKqRCBAgQIAAAQIECBAgQICA4HcDBAgQIECAAAECBAgQIEAgKCD4g0s1EgECBAgQIECAAAECBAgQEPxugAABAgQIECBAgAABAgQIBAUEf3CpRiJAgAABAgQIECBAgAABAoLfDRAgQIAAAQIECBAgQIAAgaCA4A8u1UgECBAgQIAAAQIECBAgQEDwuwECBAgQIECAAAECBAgQIBAUEPzBpRqJAAECBAgQIECAAAECBAgIfjdAgAABAgQIECBAgAABAgSCAoI/uFQjESBAgAABAgQIECBAgAABwe8GCBAgQIAAAQIECBAgQIBAUEDwB5dqJAIECBAgQIAAAQIECBAgIPjdAAECBAgQIECAAAECBAgQCAoI/uBSjUSAAAECBAgQIECAAAECBAS/GyBAgAABAgQIECBAgAABAkEBwT8s9fV6/Xme53f4F08JECBAgAABAgQIECBA4EsCn8/n7/v9/veln8v/jOAfViz4ByxPCRAgQIAAAQIECBAg8GUBwb+BCv7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm4Dg37y8JkCAAAECBAgQIECAAAECJwQE/4k1+UgCBAgQIECAAAECBAgQILAJCP7Ny2sCBAgQIECAAAECBAgQIHBCQPCfWJOPJECAAAECBAgQIECAAAECm8B/3/8RAJ+uKbMAAAAASUVORK5CYII=";

        if ((sign != blankSign) && signee) {
            frappe.call({
                method: "erpnext.crm.doctype.contract.contract.sign_contract",
                args: {
                    signee: signee,
                    contract: "{{ contract.name }}",
                    sign: sign,
                    token: "{{ contract.token }}",

                },
                freeze: true,
                callback: function (r) {
                    $("#confirm").addClass("active show in");
                    $("#review").removeClass("active show in");
                    $(".nav-item a.confirmation").addClass("active show");
                    $(".nav-item a.review-sign").removeClass("active show not-visited");
                    $(".modal-backdrop.fade.show").hide();
                }
            })
        }
        if( $sigdiv.jSignature('getData', 'native').length == 0) {
            alert('Please Enter Signature..');
         }
    });

    $("#popup-generator").on("click", function () {
        $(".modal-backdrop").show();
    });

    


    $(document).on('click touch', function (event) {
        if (!$(event.target).parents().addBack().is('#popup-generator')) {
            $('.modal-backdrop').hide();
        }
    });

});